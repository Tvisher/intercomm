@@include('./html/header.html')
<script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
<main>
    <section class="media-section media-section__inner article-page">
        <div class="container">
            <a href="javascript:void(0)" class="media-b-image">
                <img src="@img/b-image.png" alt="" />
            </a>
            <div class="media-section__content">
                <div class="media-section__col wide-col">
                    <h1 class="section-title">Личный кабинет</h1>
                    <div class="lk-settings">
                        <div class="lk-settings__head">
                            <div class="lk-settings__photo">
                                <!-- <img src="https://sakhaday.ru/wp-content/uploads/2018/08/garold1.jpg" alt=""> -->
                            </div>
                            <div class="add-photo-btn red-btn" data-open-upload-image><span>Добавить аватар</span></div>
                            <div class="lk-settings__btn red-btn ghost-btn" data-open-pass-replce>
                                <span>Сменить пароль</span>
                            </div>
                        </div>
                        <form action="" class="lk-settings__form">
                            <label class="lk-settings__label has-error">
                                <span>ФИО *</span>
                                <input type="text" placeholder="Введите ваше ФИО" class="lk-settings__input">
                                <div class="error-mes">Поле не может быть пустым</div>
                            </label>

                            <label class="lk-settings__label has-error">
                                <span>E-mail *</span>
                                <input type="email" placeholder="E-mail" class="lk-settings__input">
                                <div class="error-mes">Необходимо указать валидный Email</div>
                            </label class="lk-settings__label">

                            <label class="lk-settings__label">
                                <span>Ваш телефон</span>
                                <input type="tel" placeholder="Номер телефона" class="lk-settings__input">
                            </label>

                            <label class="lk-settings__label">
                                <span>Информация о себе</span>
                                <textarea name="" class="lk-settings__textarea" placeholder="О себе"></textarea>
                            </label>

                            <label class="lk-settings__label">
                                <span>Доп информация</span>
                                <textarea name="" class="lk-settings__textarea" placeholder="О себе"></textarea>
                            </label>
                            <button type="submit" class="red-btn">
                                <span>
                                    Сохранить
                                </span>
                            </button>
                        </form>
                        <div class="add-avatar-modal">
                            <div class="add-avatar-modal__content">
                                <div class="add-avatar-modal__close"
                                    onclick="this.closest('.show').classList.remove('show')"></div>
                                <div class="add-avatar-modal__title">Добавить аватар</div>
                                <div class="add-avatar-modal__dropzone dropzone" id="settings-dropzone">
                                    <div class="dz-message needsclick">
                                        <span>Перетащите сюда<br>файлы PNG, JPG, BMP<br>или</span>
                                        <div class="add-photo-btn red-btn"><span>Добавить аватар</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="new-pass-modal">
                            <div class="add-avatar-modal__content">
                                <div class="add-avatar-modal__close"></div>
                                <div class="add-avatar-modal__title">Новый пароль</div>
                                <form action="" class="replace-pass" id="replace-pass">
                                    <label class="pass-label">
                                        <input type="password" class="pass-input" id="oldPass"
                                            placeholder="Старый пароль">
                                        <div class="toggle-pass">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="12" cy="12" r="3" stroke="black" stroke-linecap="round" />
                                                <path
                                                    d="M21 12C21 12 16.9706 18 12 18C7.02944 18 3 12 3 12C3 12 7.02944 6 12 6C16.9706 6 21 12 21 12Z"
                                                    stroke="black" stroke-linecap="round" />
                                            </svg>
                                        </div>
                                        <div class="pass-advice">Используйте сильный пароль Aa-Ww !_# 123</div>
                                        <div class="error-mes">Старый пароль неверный!</div>
                                    </label>
                                    <label class="pass-label">
                                        <input type="password" class="pass-input" id="newPass"
                                            placeholder="Новый пароль">
                                        <div class="toggle-pass">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="12" cy="12" r="3" stroke="black" stroke-linecap="round" />
                                                <path
                                                    d="M21 12C21 12 16.9706 18 12 18C7.02944 18 3 12 3 12C3 12 7.02944 6 12 6C16.9706 6 21 12 21 12Z"
                                                    stroke="black" stroke-linecap="round" />
                                            </svg>
                                        </div>
                                        <div class="error-mes">Пароли не совпадают!</div>
                                    </label>
                                    <label class="pass-label ">
                                        <input type="password" class="pass-input" id="newPassRepeat"
                                            placeholder="Повторите пароль">
                                        <div class="toggle-pass">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="12" cy="12" r="3" stroke="black" stroke-linecap="round" />
                                                <path
                                                    d="M21 12C21 12 16.9706 18 12 18C7.02944 18 3 12 3 12C3 12 7.02944 6 12 6C16.9706 6 21 12 21 12Z"
                                                    stroke="black" stroke-linecap="round" />
                                            </svg>
                                        </div>
                                    </label>
                                    <button type="submit" class="red-btn">
                                        <span>
                                            Сохранить
                                        </span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    // const replasePassForm = document.querySelector('#replace-pass');
                    // replasePassForm.addEventListener('submit', (e) => {
                    //     e.preventDefault();
                    //     const oldPass = replasePassForm.querySelector('#oldPass');
                    //     const newPass = replasePassForm.querySelector('#newPass');
                    //     const newPassRepeat = replasePassForm.querySelector('#newPass');
                    //     [oldPass, newPass, newPassRepeat].forEach(item => {
                    //         if (item.value.length < 1) {
                    //             item.closest('.pass-label').classList.add('has-error');
                    //         }
                    //     });
                    //     if (newPass !== newPassRepeat) {
                    //         console.log(newPass !== newPassRepeat);
                    //         newPass.closest('.pass-label').classList.add('has-error');
                    //     }
                    //     // Проверяем старый пароль с помощью метода fetch
                    //     fetch('/check-old-password', {
                    //         method: 'POST',
                    //         headers: {
                    //             'Content-Type': 'application/json;charset=UTF-8'
                    //         },
                    //         body: JSON.stringify({ oldPass })
                    //     })
                    //         .then(res => {
                    //             if (!res.ok) {
                    //                 oldPass.closest('.pass-label').classList.add('has-error');
                    //             } else {
                    //                 if (replasePassForm.querySelectorAll('.has-error').length !== 0) {
                    //                     return;
                    //                 } else {
                    //                     fetch('/change-password', {
                    //                         method: 'POST',
                    //                         headers: {
                    //                             'Content-Type': 'application/json;charset=UTF-8'
                    //                         },
                    //                         body: JSON.stringify({
                    //                             oldPass,
                    //                             newPass,
                    //                             newPassRepeat
                    //                         })
                    //                     })
                    //                 }
                    //             }
                    //         });

                    // });

                    document.addEventListener('click', (e) => {
                        const target = e.target;
                        if (target.closest('.toggle-pass')) {
                            const togglePass = target.closest('.toggle-pass');
                            const toggleInput = togglePass.parentNode.querySelector('input');
                            togglePass.classList.contains('show') ? toggleInput.type = 'password' : toggleInput.type = 'text';
                            togglePass.classList.toggle('show');
                            return;
                        }
                        // Открытие модалки с загрузкой аватара
                        if (target.closest('[data-open-upload-image]')) {
                            document.querySelector('.add-avatar-modal')?.classList.add('show');
                        }

                        // Открытие модалки со сменой пароля
                        if (target.closest('[data-open-pass-replce]')) {
                            document.querySelector('.new-pass-modal')?.classList.add('show');
                        }
                        // Закрытие модалки со сменой пароля
                        if (target.closest('.new-pass-modal .add-avatar-modal__close')) {
                            const modal = document.querySelector('.new-pass-modal.show');
                            modal.classList.remove('show');
                            setTimeout(() => {
                                modal.querySelectorAll('input').forEach(input => {
                                    input.closest('.pass-label').classList.remove('has-error');
                                    input.type = 'password';
                                    input.value = '';
                                });
                                modal.querySelectorAll('.toggle-pass').forEach(toggle => toggle.classList.remove('show'));
                            }, 300);
                        }
                    });


                    const dropzoneElem = document.querySelector('.dropzone');
                    Dropzone.autoDiscover = false;
                    if (dropzoneElem) {
                        let myDropzone = new Dropzone(".dropzone", {
                            url: "/api/uploader",
                            paramName: 'temp',
                            acceptedFiles: "image/*",
                            addRemoveLinks: true,
                            maxFiles: 1,
                            maxFilesize: 50, //MB
                            dictFileTooBig: 'Файл слишком большой. Максимальный размер файла: 50MiB.',
                            dictDefaultMessage: 'Поместите файлы сюда для загрузки',
                            dictInvalidFileType: 'Вы не можете загружать файлы этого типа.',
                            dictFallbackMessage: "Ваш браузер не поддерживает загрузку файлов drag'n'drop.",
                            success: (file, response) => {
                                console.log(file, response);
                            },
                            addedfile: function (file) {
                                const fileType = file.type.startsWith("image/");
                                if (!fileType) {
                                    alert("Поддеживается только загрузка изображений");
                                    return;
                                }
                                const imagePreview = document.querySelector('.lk-settings__photo');
                                if (!imagePreview) return;
                                imagePreview.innerHTML = '';
                                const reader = new FileReader();
                                reader.onload = function (event) {
                                    const img = document.createElement("img");
                                    img.setAttribute("src", event.target.result);
                                    imagePreview.appendChild(img);
                                };
                                reader.readAsDataURL(file);
                                document.querySelector('.add-avatar-modal.show')?.classList.remove('show');
                            }
                        });
                    }
                </script>
                <div class="media-section__col">
                    <div id="pc-nav-sidebar-parent">
                        <ul class="nav-sidebar services-sidebar" id="nav-sidebar">
                            <li class="nav-sidebar__item sidebar-item active">
                                <div class="sidebar-item__head ">
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Мой календарь</div>
                                        <div class="sidebar-item__counter">192</div>
                                    </a>
                                </div>
                            </li>

                            <li class="nav-sidebar__item sidebar-item">
                                <div class="sidebar-item__head">
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Избранное</div>
                                        <div class="sidebar-item__counter">72</div>
                                    </a>
                                </div>
                            </li>

                            <li class="nav-sidebar__item sidebar-item">
                                <div class="sidebar-item__head">
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Центр сообщений</div>
                                    </a>
                                </div>
                            </li>

                            <li class="nav-sidebar__item sidebar-item">
                                <div class="sidebar-item__head">
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Настройки</div>
                                    </a>
                                </div>
                            </li>
                            <li class="nav-sidebar__item sidebar-item">
                                <div class="sidebar-item__head">
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Помощь</div>
                                    </a>
                                </div>
                            </li>
                            <li class="nav-sidebar__item sidebar-item">
                                <div class="sidebar-item__head toggle-open">
                                    <div class="sidebar-item__arrow"></div>
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Инструменты для сайтов</div>
                                    </a>
                                </div>
                                <ul class="sidebar-item__body toggle-open">
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Шар с поздравлениями</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Калькуляторы</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Типограф</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Система генерации электронных открыток
                                                </div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Сервис рассылок</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Конструктор Квизов/Конкурсов/Викторин
                                                </div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Чат на сайт</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Сервис по оформлению сайта ( плагины
                                                    снег и проч красивоти т.п.)</div>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </li>

                            <li class="nav-sidebar__item sidebar-item">
                                <div class="sidebar-item__head toggle-open">
                                    <div class="sidebar-item__arrow"></div>
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Коробочные решения</div>
                                    </a>
                                </div>
                                <ul class="sidebar-item__body toggle-open">
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">База знаний</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Модули Bitrix (сразу выводим список
                                                    решений, их будет мало)</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Редактор</div>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </li>

                            <li class="nav-sidebar__item sidebar-item">
                                <div class="sidebar-item__head toggle-open">
                                    <div class="sidebar-item__arrow"></div>
                                    <a href="javascript:void(0)" class="sidebar-item__link">
                                        <div class="sidebar-item__title">Магазин</div>
                                    </a>
                                </div>
                                <ul class="sidebar-item__body toggle-open">
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Покупки</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Индивидуальные заказы</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Техническая поддержка</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">Контентная поддержка</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">3D моделирование</div>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-sidebar__item sidebar-item">
                                        <div class="sidebar-item__head">
                                            <a href="javascript:void(0)" class="sidebar-item__link">
                                                <div class="sidebar-item__title">AR,VR, IVR</div>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <a href="javascript:void(0)" class="inner-banner _small">
                        <img src="@img/inner-banner.jpg" alt="" class="inner-banner__img" />
                        <div class="inner-banner__content">
                            <h3 class="inner-banner__title">Баннер</h3>
                            <span class="inner-banner__text">Текст текст текст</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>
</main>

@@include('./html/footer.html')